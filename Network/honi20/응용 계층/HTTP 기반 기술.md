# HTTP 기반 기술

## 캐시

- 응답 받은 자원의 **사본**을 임시 저장하는 기술
- 추후 동일한 요청에 대해 캐시된 데이터를 활용할 수 있다.
- 캐시된 데이터는 얼마든지 원본 데이터와 달라질 수 있다.
- **캐시 신선도**의 검사와 유지 필요

#### 장점

- 불필요한 대역폭 방지
- 응답 지연 방지
- 빠른 자원 접근 가능

#### 개인 전용 캐시

    웹 브라우저에 저장

#### 공용 캐시

    클라이언트와 서버 사이에 위치한 중간 서버에 저장

#### 캐시 신선도(Cache Freshness)

    캐시된 사본 데이터가 얼마나 최신 원본 데이터와 유사한지를 표현

<br>

### 💡 캐시 신선도 검사 - 유효 기간 설정

- 기간이 만료되었다면 원본 데이터를 다시 요청
- 응답 메시지의 `Expires` 헤더(날짜)와 `Cache-Control` 헤더의 `Max-Age` 값(초)을 사용

<br>

### 💡 캐시 신선도 재검사 - 날짜 기반

#### 클라이언트의 `If-Modified-Since` 헤더

- 날짜를 기반으로 서버에게 물어보는 방법
- 헤더에 명시된 시점 이후로 원본에 변경이 있었다면 그때만 새 자원으로 응답하도록 서버에게 요청하는 헤더

#### 서버의 `Last-Modified` 헤더

- 상태 코드 304를 통한 자원의 '변경 여부' 뿐만 아니라 자원이 마지막으로 수정된 시점도 알려줄 수 있다.

<br>

### 💡 캐시 신선도 재검사 - Entity Tag 기반

#### 클라이언트의 `If-None-Match` 헤더

- 엔티티 태그를 기반으로 서버에게 물어보는 방식
- Etag는 '자원의 버전'을 식별하기 위한 정보
- 버전이란 '유의미한 변경 사항'
- 즉, 자원이 변경될 때마다 자원의 버전을 식별하는 Etag 값 변경
  - 자원이 변경되었다면 새 자원으로 응답
- 반대로 자원이 변경되지 않았다면 Etag 값도 변경되지 않는다.
  - 서버는 304 응답 코드 반환

<br>

## 쿠키

- 서버에서 생성되어 클라이언트 측에 저장되는 데이터
- 상태를 유지하지 않는 HTT의 특성을 보완하기 위한 수단
- 기본적으로 `<이름, 값>` 쌍의 형태
- 추가로 다양한 속성을 가질 수 있다.
- 서버는 쿠키를 생성하여 클라이언트에게 전송
- 클라이언트는 전달받은 쿠키를 저장해 두었다가 추후 요청 메시지에 쿠키를 포함하여 전송
- 요청이 같은 클라이언트에서 왔는지 로그인 상태를 유지하고 있는지 등을 알 수 있다.
- 쿠키는 브라우저에서 저장되고 관리

<br>

### 💡 세션 인증

1. 클라이언트는 서버에게 인증 정보(아이디, 비밀번호 등)를 전송
2. 인증 정보가 올바르다면, 서버는 세션 아이디를 생성해 클라이언트에게 전송
3. 서버는 생성한 세션 아이디를 데이터베이스 등에 저장
4. 클라이언트는 추후 요청을 보낼 때 쿠키 내에 세션 아이디를 포함하여 전송
5. 서버는 쿠키 속 세션 아이디와 저장된 세션 아이디를 비교하여 클라이언트를 식별
   => 요청을 보낼 때마다 번거로운 인증 과정을 거칠 필요가 없다.

<br>

### 💡 서버의 쿠키 생성

- 서버는 응답 메시지의 `Set-Cookie` 헤더를 통해 생성된 쿠키를 받는다.
- 클라이언트는 요청 메시지의 `Cookie` 헤더를 통해 쿠키를 전달한다.

#### 응답 메시지의 `Set-Cookie` 헤더

- 쿠키의 이름, 값과 더불어 세미콜론(;)으로 구분되는 속성들을 전달
- 한 응답 메시지에 전달할 쿠키가 여러 개라면 여러 개의 Set-Cookie로 전달

#### 요청 메시지의 `Cookie` 헤더

- 서버에 전달할 쿠키의 이름과 값을 나타내는 헤더
- 여러 개의 쿠키 값을 서버에 전달해야 할 때는 세미 콜론을 사용

<br>

### 💡 쿠키의 속성

#### domain

- 쿠키는 사용 가능한 도메인이 정해져 있다.
- 응답 메시지 속 `Set-Cookie` 헤더의 **domain** 속성으로 정한다.

#### path

- 같은 도메인이라도 경로별로 쿠키를 구분하여 사용하고 싶은 경우
- **path** 속성으로 쿠키가 적용될 경로를 명시
- 지정된 경로 + 하위 경로에서 크키 활용

#### 유효 기간

- **Expires** 속성을 통해 쿠키 만료 시점 지정
- **Max-Age** 속성을 통해 초 단위 유효 기간 지정

<br>

### 💡 쿠키의 보안

- 쿠키의 대표적인 한계는 보안
- 쿠키 정보는 쉽게 노출되거나 조작될 수 있다.

#### Secure

    HTTPS 프로토콜이 사용되는 경우에만 쿠키 전송

#### HttpOnly

    HTTP 송수신을 통해서만 쿠키를 이용하도록 제한하는 속성
    쿠키 관련 데이터는 JS 언어를 통해서도 접근 가능
    HttpOnly는 JS에서 쿠키에 접근하지 못하도록 하는 속성

<br>

### 💡 웹 스토리지(web storage)

- 클라이언트가 저장하고 클라이언트의 상태를 추측할 수 있는 <키-값> 쌍 형태의 정보
- 웹 브라우저 내에 저장
- 일반적으로 쿠키보다 더 큰 데이터 저장 가능
- 크키는 서버로 자동 전송되지만, 웹 스토리지의 정보는 서버로 자동 전송되지 않는다.

#### 로컬 스토리지

    별도로 삭제하지 않는 한 영구적으로 저장이 가능한 정보

#### 세션 스토리지

    세션이 유지되는 동안 유지되는 정보

<br>

## 콘텐츠 협상

- 같은 URI에 대해 클라이언트에게 가장 적합한 '**자원의 표현**'를 제공하는 메커니즘

#### 자원의 표현

    송수신 가능한 자원의 형태

<br>

### 💡 콘텐츠 협상 관련 HTTP 헤더

#### Accept 헤더

    선호하는 미디어 타입

#### Accept-Language

    선호하는 언어

#### Accept-Charset 및 Accept-Encoding

    선호하는 문자 인코딩과 압축 방식

<br>

### 💡 선호도에 우선순위 반영

- 우선순위는 콘텐츠 협상 관련 헤더의 q값으로 표현
- 값이 클수록 우선순위가 높다.
- 생략되었을 경우에는 1을 의미
- 범위: 0 ~ 1
